{
     "builder": "SIoTRxBuilder",
    "description": "## Validating RDF and querying it with its SHACL report\n### This mapping shows how to retrieve [RDF data from a remote endpoint](https://raw.githubusercontent.com/helio-ecosystem/helio-ecosystem/main/resources/siotrx/actions/shacl/sample-dataset.rdf), cast it into a suitable serialisation and, then, validate the data using [a remote SHACL shape](https://raw.githubusercontent.com/helio-ecosystem/helio-ecosystem/main/resources/siotrx/actions/shacl/sample-shacl.n3). In addition, after the validation the mapping allows to query the data and the SHACL report for extracting information over the RDF nodes that did not conform to the shape.<br /><br />The mapping combines different components form the Helio ecosystem: [HttpProvider](https://github.com/helio-ecosystem/helio-action-http-request), for fetching data; [RdfCast](https://github.com/helio-ecosystem/helio-action-rdf-cast), for serialiasing; [ShaclValidator](https://github.com/helio-ecosystem/helio-action-shacl-validator), for applying SHACL shapes over RDF; and [SparqlEngine](https://github.com/helio-ecosystem/helio-action-sparql-engine), for querying the RDF.",
    "user_template": "<#-- RDF data --> \r\n<#assign rdf = providers(\"HttpProvider\", {\"method\" : \"GET\", \"url\" : \"https:\/\/raw.githubusercontent.com\/helio-ecosystem\/helio-ecosystem\/main\/resources\/siotrx\/actions\/shacl\/sample-dataset.rdf\"})>\r\n\r\n<#--SHACL shape-->\r\n<#assign shape=\"https:\/\/raw.githubusercontent.com\/helio-ecosystem\/helio-ecosystem\/main\/resources\/siotrx\/actions\/shacl\/sample-shacl.n3\">\r\n\r\n<#-- Cast RDF into NT -->\r\n<#assign config = {\"data-format\" : \"rdf\/xml\", \"output-format\" : \"nt\"}>\r\n<@action type=\"RdfCast\" data=rdf conf=config; result>\r\n<#assign rdf = result>\r\n<\/@action>\r\n\r\n\r\n<#-- Setting up output format to N3 -->\r\n<#assign config='{\"shape\" : \"'+shape+'\", \"shape-format\" : \"n3\", \"data-format\" : \"nt\", \"output-format\" : \"nt\" }'>\r\n<#-- Running the validation -->\r\n<@action type=\"ShaclValidator\" data=rdf conf=config; report>\r\n<#-- Aggregating report into data -->\r\n<#assign rdf = rdf+\"\\n\"+report>\r\n<\/@action>\r\n\r\n<#-- Querying the report+RDF data -->\r\n<#assign query = \"SELECT ?node ?message ?path WHERE { ?s <http:\/\/www.w3.org\/ns\/shacl#focusNode> ?node . ?s <http:\/\/www.w3.org\/ns\/shacl#resultMessage> ?message . ?s <http:\/\/www.w3.org\/ns\/shacl#resultPath> ?path}\">\r\n<#assign config = '{\"query\" : \"'+query+'\" }'>\r\n<@action type=\"SparqlEngine\" data=rdf conf=config; result>\r\n[=result]\r\n<\/@action>\r\n",
    "solution_template": "<#-- RDF data --> \r\n<#assign rdf = providers(\"HttpProvider\", {\"method\" : \"GET\", \"url\" : \"https:\/\/raw.githubusercontent.com\/helio-ecosystem\/helio-ecosystem\/main\/resources\/siotrx\/actions\/shacl\/sample-dataset.rdf\"})>\r\n\r\n<#--SHACL shape-->\r\n<#assign shape=\"https:\/\/raw.githubusercontent.com\/helio-ecosystem\/helio-ecosystem\/main\/resources\/siotrx\/actions\/shacl\/sample-shacl.n3\">\r\n\r\n<#-- Cast RDF into NT -->\r\n<#assign config = {\"data-format\" : \"rdf\/xml\", \"output-format\" : \"nt\"}>\r\n<@action type=\"RdfCast\" data=rdf conf=config; result>\r\n<#assign rdf = result>\r\n<\/@action>\r\n\r\n\r\n<#-- Setting up output format to N3 -->\r\n<#assign config='{\"shape\" : \"'+shape+'\", \"shape-format\" : \"n3\", \"data-format\" : \"nt\", \"output-format\" : \"nt\" }'>\r\n<#-- Running the validation -->\r\n<@action type=\"ShaclValidator\" data=rdf conf=config; report>\r\n<#-- Aggregating report into data -->\r\n<#assign rdf = rdf+\"\\n\"+report>\r\n<\/@action>\r\n\r\n<#-- Querying the report+RDF data -->\r\n<#assign query = \"SELECT ?node ?message ?path WHERE { ?s <http:\/\/www.w3.org\/ns\/shacl#focusNode> ?node . ?s <http:\/\/www.w3.org\/ns\/shacl#resultMessage> ?message . ?s <http:\/\/www.w3.org\/ns\/shacl#resultPath> ?path}\">\r\n<#assign config = '{\"query\" : \"'+query+'\" }'>\r\n<@action type=\"SparqlEngine\" data=rdf conf=config; result>\r\n[=result]\r\n<\/@action>\r\n",
    "expected_result": "{ \"head\": {\r\n    \"vars\": [ \"node\" , \"message\" , \"path\" ]\r\n  } ,\r\n  \"results\": {\r\n    \"bindings\": [\r\n      { \r\n        \"node\": { \"type\": \"uri\" , \"value\": \"https:\/\/sample.es\/resources\/Alice\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Pattern[^\\\\\\\\d{3}-\\\\\\\\d{2}-\\\\\\\\d{4}$]: Does not match: '987-65-432A'\" } ,\r\n        \"path\": { \"type\": \"uri\" , \"value\": \"https:\/\/sample.es\/resources\/ssn\" }\r\n      } ,\r\n      { \r\n        \"node\": { \"type\": \"uri\" , \"value\": \"https:\/\/sample.es\/resources\/Bob\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Pattern[^\\\\\\\\d{3}-\\\\\\\\d{2}-\\\\\\\\d{4}$]: Does not match: '123-45-6789'\" } ,\r\n        \"path\": { \"type\": \"uri\" , \"value\": \"https:\/\/sample.es\/resources\/ssn\" }\r\n      } ,\r\n      { \r\n        \"node\": { \"type\": \"uri\" , \"value\": \"https:\/\/sample.es\/resources\/Calvin\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Closed[https:\/\/sample.es\/resources\/ssn, https:\/\/sample.es\/resources\/worksFor][http:\/\/www.w3.org\/1999\/02\/22-rdf-syntax-ns#type] Property = <https:\/\/sample.es\/resources\/birthDate> : Object = \\\"1971-07-07\\\"^^xsd:date\" } ,\r\n        \"path\": { \"type\": \"uri\" , \"value\": \"https:\/\/sample.es\/resources\/birthDate\" }\r\n      } ,\r\n      { \r\n        \"node\": { \"type\": \"uri\" , \"value\": \"https:\/\/sample.es\/resources\/Calvin\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"ClassConstraint[<https:\/\/sample.es\/resources\/Company>]: Expected class :<https:\/\/sample.es\/resources\/Company> for <https:\/\/sample.es\/resources\/UntypedCompany>\" } ,\r\n        \"path\": { \"type\": \"uri\" , \"value\": \"https:\/\/sample.es\/resources\/worksFor\" }\r\n      } ,\r\n      { \r\n        \"node\": { \"type\": \"uri\" , \"value\": \"https:\/\/sample.es\/resources\/Bob\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Pattern[^\\\\\\\\d{3}-\\\\\\\\d{2}-\\\\\\\\d{4}$]: Does not match: '124-35-6789'\" } ,\r\n        \"path\": { \"type\": \"uri\" , \"value\": \"https:\/\/sample.es\/resources\/ssn\" }\r\n      } ,\r\n      { \r\n        \"node\": { \"type\": \"uri\" , \"value\": \"https:\/\/sample.es\/resources\/Bob\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"maxCount[1]: Invalid cardinality: expected max 1: Got count = 2\" } ,\r\n        \"path\": { \"type\": \"uri\" , \"value\": \"https:\/\/sample.es\/resources\/ssn\" }\r\n      }\r\n    ]\r\n  }\r\n}"
}
