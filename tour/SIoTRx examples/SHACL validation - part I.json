{
  "builder": "SIoTRxBuilder",
  "description": "## SHACL validation\n### This mapping shows how to use the [SHACL validator action](https://github.com/helio-ecosystem/helio-action-shacl-validator) for validating RDF using a SHACL shape having both in the mapping. Note that either the shape and the data are expressed in TURTLE.<br /><br /> In this mapping it is shown how to validate RDF, however, writing the RDF and the shape directly in the mapping is not always suitable. To this end, the [SHACL validation part II](https://helio-playground.linkeddata.es/tour/SIoTRx%20examples/SHACL%20validation%20-%20part%20II) shows how to retrieve the data and the shapes from remote URLs.",
  "user_template": "<#-- RDF data -->\r\n<#assign rdf>\r\n@prefix ex: <https:\/\/sample.es\/resources\/> .\r\n@prefix xsd: <http:\/\/www.w3.org\/2001\/XMLSchema#> .\r\n\r\nex:Alice \r\n  a ex:Person ; \r\n  ex:ssn \"987-65-432A\" . \r\n\r\nex:Bob \r\n  a ex:Person ; \r\n  ex:ssn \"123-45-6789\" ; \r\n  ex:ssn \"124-35-6789\" . \r\n\r\nex:Calvin \r\n  a ex:Person ; \r\n  ex:birthDate \"1971-07-07\"^^xsd:date ; \r\n  ex:worksFor ex:UntypedCompany .\r\n<\/#assign>\r\n\r\n<#-- SHACL shape -->\r\n<#assign shape>\r\n@prefix ex: <https:\/\/sample.es\/resources\/> .\r\n@prefix xsd: <http:\/\/www.w3.org\/2001\/XMLSchema#> .\r\n@prefix sh: <http:\/\/www.w3.org\/ns\/shacl#> .\r\n@prefix rdf: <http:\/\/www.w3.org\/1999\/02\/22-rdf-syntax-ns#> .\r\n\r\nex:PersonShape \r\n  a sh:NodeShape ; \r\n  sh:targetClass ex:Person ; \r\n  sh:property [\t\t\t# _:b1\r\n    sh:path ex:ssn ; \r\n    sh:maxCount 1 ; \r\n    sh:datatype xsd:string ; \r\n    sh:pattern \"^\\\\d{3}-\\\\d{2}-\\\\d{4}$\" ; \r\n  ] ; \r\n  sh:property [\t\t\t# _:b2\r\n    sh:path ex:worksFor ; \r\n    sh:class ex:Company ; \r\n    sh:nodeKind sh:IRI ; \r\n  ] ; \r\n  sh:closed true ; \r\n  sh:ignoredProperties ( rdf:type ) .\r\n<\/#assign>\r\n<#-- Escaping the SHACL shape -->\r\n<#assign shape = shape?js_string>\r\n\r\n<#-- Running the validation -->\r\n<#assign config=\"{\\\"shape\\\" : \\\"\"+shape+\"\\\" }\">\r\n<@action type=\"ShaclValidator\" data=rdf conf=config; report>\r\n[=report]\r\n<\/@action>\r\n\r\n",
  "solution_template": "<#-- RDF data -->\r\n<#assign rdf>\r\n@prefix ex: <https:\/\/sample.es\/resources\/> .\r\n@prefix xsd: <http:\/\/www.w3.org\/2001\/XMLSchema#> .\r\n\r\nex:Alice \r\n  a ex:Person ; \r\n  ex:ssn \"987-65-432A\" . \r\n\r\nex:Bob \r\n  a ex:Person ; \r\n  ex:ssn \"123-45-6789\" ; \r\n  ex:ssn \"124-35-6789\" . \r\n\r\nex:Calvin \r\n  a ex:Person ; \r\n  ex:birthDate \"1971-07-07\"^^xsd:date ; \r\n  ex:worksFor ex:UntypedCompany .\r\n<\/#assign>\r\n\r\n<#-- SHACL shape -->\r\n<#assign shape>\r\n@prefix ex: <https:\/\/sample.es\/resources\/> .\r\n@prefix xsd: <http:\/\/www.w3.org\/2001\/XMLSchema#> .\r\n@prefix sh: <http:\/\/www.w3.org\/ns\/shacl#> .\r\n@prefix rdf: <http:\/\/www.w3.org\/1999\/02\/22-rdf-syntax-ns#> .\r\n\r\nex:PersonShape \r\n  a sh:NodeShape ; \r\n  sh:targetClass ex:Person ; \r\n  sh:property [\t\t\t# _:b1\r\n    sh:path ex:ssn ; \r\n    sh:maxCount 1 ; \r\n    sh:datatype xsd:string ; \r\n    sh:pattern \"^\\\\d{3}-\\\\d{2}-\\\\d{4}$\" ; \r\n  ] ; \r\n  sh:property [\t\t\t# _:b2\r\n    sh:path ex:worksFor ; \r\n    sh:class ex:Company ; \r\n    sh:nodeKind sh:IRI ; \r\n  ] ; \r\n  sh:closed true ; \r\n  sh:ignoredProperties ( rdf:type ) .\r\n<\/#assign>\r\n<#-- Escaping the SHACL shape -->\r\n<#assign shape = shape?js_string>\r\n\r\n<#-- Running the validation -->\r\n<#assign config=\"{\\\"shape\\\" : \\\"\"+shape+\"\\\" }\">\r\n<@action type=\"ShaclValidator\" data=rdf conf=config; report>\r\n[=report]\r\n<\/@action>\r\n\r\n",
  "expected_result": "@prefix ex:   <https:\/\/sample.es\/resources\/> .\r\n@prefix rdf:  <http:\/\/www.w3.org\/1999\/02\/22-rdf-syntax-ns#> .\r\n@prefix rdfs: <http:\/\/www.w3.org\/2000\/01\/rdf-schema#> .\r\n@prefix sh:   <http:\/\/www.w3.org\/ns\/shacl#> .\r\n@prefix xsd:  <http:\/\/www.w3.org\/2001\/XMLSchema#> .\r\n\r\n[ rdf:type     sh:ValidationReport ;\r\n  sh:conforms  false ;\r\n  sh:result    [ rdf:type                      sh:ValidationResult ;\r\n                 sh:focusNode                  ex:Calvin ;\r\n                 sh:resultMessage              \"ClassConstraint[<https:\/\/sample.es\/resources\/Company>]: Expected class :<https:\/\/sample.es\/resources\/Company> for <https:\/\/sample.es\/resources\/UntypedCompany>\" ;\r\n                 sh:resultPath                 ex:worksFor ;\r\n                 sh:resultSeverity             sh:Violation ;\r\n                 sh:sourceConstraintComponent  sh:ClassConstraintComponent ;\r\n                 sh:sourceShape                []  ;\r\n                 sh:value                      ex:UntypedCompany\r\n               ] ;\r\n  sh:result    [ rdf:type                      sh:ValidationResult ;\r\n                 sh:focusNode                  ex:Calvin ;\r\n                 sh:resultMessage              \"Closed[https:\/\/sample.es\/resources\/ssn, https:\/\/sample.es\/resources\/worksFor][http:\/\/www.w3.org\/1999\/02\/22-rdf-syntax-ns#type] Property = <https:\/\/sample.es\/resources\/birthDate> : Object = \\\"1971-07-07\\\"^^xsd:date\" ;\r\n                 sh:resultPath                 ex:birthDate ;\r\n                 sh:resultSeverity             sh:Violation ;\r\n                 sh:sourceConstraintComponent  sh:ClosedConstraintComponent ;\r\n                 sh:sourceShape                ex:PersonShape ;\r\n                 sh:value                      \"1971-07-07\"^^xsd:date\r\n               ] ;\r\n  sh:result    [ rdf:type                      sh:ValidationResult ;\r\n                 sh:focusNode                  ex:Alice ;\r\n                 sh:resultMessage              \"Pattern[^\\\\d{3}-\\\\d{2}-\\\\d{4}$]: Does not match: '987-65-432A'\" ;\r\n                 sh:resultPath                 ex:ssn ;\r\n                 sh:resultSeverity             sh:Violation ;\r\n                 sh:sourceConstraintComponent  sh:PatternConstraintComponent ;\r\n                 sh:sourceShape                _:b0 ;\r\n                 sh:value                      \"987-65-432A\"\r\n               ] ;\r\n  sh:result    [ rdf:type                      sh:ValidationResult ;\r\n                 sh:focusNode                  ex:Bob ;\r\n                 sh:resultMessage              \"maxCount[1]: Invalid cardinality: expected max 1: Got count = 2\" ;\r\n                 sh:resultPath                 ex:ssn ;\r\n                 sh:resultSeverity             sh:Violation ;\r\n                 sh:sourceConstraintComponent  sh:MaxCountConstraintComponent ;\r\n                 sh:sourceShape                _:b0\r\n               ]\r\n] ."
}
