{
     "builder": "SIoTRxBuilder",
    "description": "## Practice on SHACL part VI\n### Taking as input the mapping defined in the [Practice on SHACL part V](https://helio-playground.linkeddata.es/tour/SIoTRx%20practice%20on%20actions/Practice%20on%20SHACL%20part%20IV) add a new `sh:PropertyShape` to the Shape. The new `sh:PropertyShape` must be related to the `sh:NodeShape` of the class *schema:CivicStructure* and define a `sh:path ( schema:address schema:postalCode )` and a `sh:minCount 1 `. Finally, validate the validate the [lcc dataset](https://raw.githubusercontent.com/helio-ecosystem/helio-ecosystem/main/resources/siotrx/actions/shacl/lcc-dataset.ttl) using the [SHACL validator action](https://github.com/helio-ecosystem/helio-action-shacl-validator) (if you need help with this component have a view at [its tutorials](https://helio-playground.linkeddata.es/tour/SIoTRx%20tutorial%20on%20actions/SHACL%20validation%20-%20part%20I)) and query the RDF data and the report to know how many instances do not pass the validation (if you need a hint on how to perform the query have a look at the example [Validating RDF and querying it with its SHACL report](https://helio-playground.linkeddata.es/tour/SIoTRx%20examples/Validating%20RDF%20and%20querying%20it%20with%20its%20SHACL%20report)). The query must return the total number of *schema:CivicStructure* instances present in the dataset and the number of those that are not conform to the shape, i.e., do not pass the validation.<br /><br />Once the mapping is done, you can move to [Practice on SHACL part VI](https://helio-playground.linkeddata.es/tour/SIoTRx%20practice%20on%20actions/Practice%20on%20SHACL%20part%20VI) adding more complexity to the shape.",
    "solution_template": "<#-- Shape --> \r\n<#assign shape>\r\n@prefix schema: <http:\/\/schema.org\/> .\r\n@prefix sh: <http:\/\/www.w3.org\/ns\/shacl#> .\r\n@prefix ex: <http:\/\/shacl-practice.helio\/resource\/>.\r\n@prefix ec: <http:\/\/shacl-practice.helio\/ontology#>\r\n\r\n<#-- DONE: define the new sh:PropertyShape with restriction sh:path and sh:minCount -->\r\nex:AddressPlusPostalShape \r\n  a sh:PropertyShape ;\r\n  sh:path ( schema:address schema:postalCode ) ;\r\n  sh:minCount 1 . \r\n\r\nex:UPRNShape a sh:PropertyShape ;\r\n  sh:path ec:uprn ;\r\n  sh:minCount 1 .\r\n\r\n<#-- DONE: Relate the new sh:PropertyShape to the sh:NodeShape of schema:CivicStructure-->\r\nex:CivicStructureShape \r\n  a sh:NodeShape ; \r\n  sh:targetClass schema:CivicStructure ;\r\n  sh:property ex:UPRNShape, ex:AddressPlusPostalShape  .\r\n\r\nex:MuseumShape \r\n  a sh:NodeShape ; \r\n  sh:targetClass schema:Museum ;\r\n  sh:property ex:UPRNShape .\r\n\r\nex:UniversityShape \r\n  a sh:NodeShape ; \r\n  sh:targetClass schema:CollegeOrUniversity ;\r\n  sh:property ex:UPRNShape .\r\n<\/#assign>\r\n\r\n<#--  Fetch and cast the RDF into NT serialization -->\r\n<#assign rdf = providers(\"HttpProvider\", {\"method\" : \"GET\", \"url\" : \"https:\/\/raw.githubusercontent.com\/helio-ecosystem\/helio-ecosystem\/main\/resources\/siotrx\/actions\/shacl\/lcc-dataset.ttl\"})>\r\n<#assign config = {\"data-format\" : \"turtle\", \"output-format\" : \"nt\"}>\r\n<@action type=\"RdfCast\" data=rdf conf=config; result>\r\n<#assign rdf = result>\r\n<\/@action>\r\n\r\n\r\n<#-- Running the validation -->\r\n<#-- configure the action to output report in NT serialization -->\r\n<#assign config=\"{\\\"shape\\\" : \\\"\"+shape+\"\\\", \\\"output-format\\\" : \\\"nt\\\"  }\">\r\n<@action type=\"ShaclValidator\" data=rdf conf=config; report>\r\n<#--  aggregate the RDF and the report into a variable-->\r\n<#assign rdf = rdf+\"\\n\"+report>\r\n<\/@action>\r\n\r\n<#--  DONE: change the query to return the total number of schema:CivicStructure instances in the dataset, and the number of those not passing the validation due to the new sh:PropertyShape defined  -->\r\n<#assign query = \"SELECT (count(distinct ?instance) as ?notConformingInstances) (count(distinct ?allInstances) as ?totalInstances) WHERE { ?instance a <http:\/\/schema.org\/CivicStructure> . ?shape <http:\/\/www.w3.org\/ns\/shacl#focusNode> ?instance . ?shape <http:\/\/www.w3.org\/ns\/shacl#sourceShape> <http:\/\/shacl-practice.helio\/resource\/AddressPlusPostalShape> . ?allInstances a <http:\/\/schema.org\/CivicStructure>} \">\r\n<#assign config = '{\"query\" : \"'+query+'\" }'>\r\n<@action type=\"SparqlEngine\" data=rdf conf=config; result>\r\n[=result]\r\n<\/@action>\r\n",
    "user_template": "<#-- Shape --> \r\n<#assign shape>\r\n@prefix schema: <http:\/\/schema.org\/> .\r\n@prefix sh: <http:\/\/www.w3.org\/ns\/shacl#> .\r\n@prefix ex: <http:\/\/shacl-practice.helio\/resource\/>.\r\n@prefix ec: <http:\/\/shacl-practice.helio\/ontology#>\r\n\r\n<#-- TODO: define the new sh:PropertyShape with restriction sh:path and sh:minCount -->\r\n<#-- TODO: Relate the new sh:PropertyShape to the sh:NodeShape of schema:CivicStructure-->\r\n\r\nex:UPRNShape a sh:PropertyShape ;\r\n  sh:path ec:uprn ;\r\n  sh:minCount 1 .\r\n\r\nex:CivicStructureShape \r\n  a sh:NodeShape ; \r\n  sh:targetClass schema:CivicStructure ;\r\n  sh:property ex:UPRNShape .\r\n\r\nex:MuseumShape \r\n  a sh:NodeShape ; \r\n  sh:targetClass schema:Museum ;\r\n  sh:property ex:UPRNShape .\r\n\r\nex:UniversityShape \r\n  a sh:NodeShape ; \r\n  sh:targetClass schema:CollegeOrUniversity ;\r\n  sh:property ex:UPRNShape .\r\n<\/#assign>\r\n\r\n<#--  Fetch and cast the RDF into NT serialization -->\r\n<#assign rdf = providers(\"HttpProvider\", {\"method\" : \"GET\", \"url\" : \"https:\/\/raw.githubusercontent.com\/helio-ecosystem\/helio-ecosystem\/main\/resources\/siotrx\/actions\/shacl\/lcc-dataset.ttl\"})>\r\n<#assign config = {\"data-format\" : \"turtle\", \"output-format\" : \"nt\"}>\r\n<@action type=\"RdfCast\" data=rdf conf=config; result>\r\n<#assign rdf = result>\r\n<\/@action>\r\n\r\n\r\n<#-- Running the validation -->\r\n<#-- configure the action to output report in NT serialization -->\r\n<#assign config=\"{\\\"shape\\\" : \\\"\"+shape+\"\\\", \\\"output-format\\\" : \\\"nt\\\"  }\">\r\n<@action type=\"ShaclValidator\" data=rdf conf=config; report>\r\n<#--  aggregate the RDF and the report into a variable-->\r\n<#assign rdf = rdf+\"\\n\"+report>\r\n<\/@action>\r\n\r\n<#--  TODO: change the query to return the total number of schema:CivicStructure instances in the dataset, and the number of those not passing the validation due to the new sh:PropertyShape defined  -->\r\n<#assign query = \"\">\r\n<#assign config = '{\"query\" : \"'+query+'\" }'>\r\n<@action type=\"SparqlEngine\" data=rdf conf=config; result>\r\n[=result]\r\n<\/@action>\r\n",
    "expected_result": "{ \"head\": {\r\n    \"vars\": [ \"notConformingInstances\" , \"totalInstances\" ]\r\n  } ,\r\n  \"results\": {\r\n    \"bindings\": [\r\n      { \r\n        \"notConformingInstances\": { \"type\": \"literal\" , \"datatype\": \"http:\/\/www.w3.org\/2001\/XMLSchema#integer\" , \"value\": \"982\" } ,\r\n        \"totalInstances\": { \"type\": \"literal\" , \"datatype\": \"http:\/\/www.w3.org\/2001\/XMLSchema#integer\" , \"value\": \"1867\" }\r\n      }\r\n    ]\r\n  }\r\n}"
}
