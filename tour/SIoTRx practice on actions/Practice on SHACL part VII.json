{
     "builder": "SIoTRxBuilder",
    "description": "## Practice on SHACL part VII\n### Define a new SHACL shape that contains a `sh:NodeShape` that applies to any *ssn:ObservationValue* instance. Then, add a `sh:PropertyShape` related to the property *lcc:hasQuantityValue* with the restriction `sh:minInclusive \"0\"^^xsd:decimal`. As a final step, relate the `sh:NodeShape` to the `sh:PropertyShape`. Finally, validate the [lcc dataset](https://raw.githubusercontent.com/helio-ecosystem/helio-ecosystem/main/resources/siotrx/actions/shacl/lcc-dataset.ttl) using the [SHACL validator action](https://github.com/helio-ecosystem/helio-action-shacl-validator) (if you need help with this component have a view at [its tutorials](https://helio-playground.linkeddata.es/tour/SIoTRx%20tutorial%20on%20actions/SHACL%20validation%20-%20part%20I)) and query the RDF data and the report (if you need a hint on how to perform the query have a look at the example [Validating RDF and querying it with its SHACL report](https://helio-playground.linkeddata.es/tour/SIoTRx%20examples/Validating%20RDF%20and%20querying%20it%20with%20its%20SHACL%20report)). The query must return all those data instances that do not pass the validation, the value of their *lcc:hasQuantityValue*, and the `sh:resultMessage` obtained in the report.<br /><br />Once the mapping is done, you can move to [Practice on SHACL part VIII](https://helio-playground.linkeddata.es/tour/SIoTRx%20practice%20on%20actions/Practice%20on%20SHACL%20part%20VIII) adding more complexity to the shape.",
    "solution_template": "<#-- Shape --> \r\n<#assign shape>\r\n@prefix schema: <http:\/\/schema.org\/> .\r\n@prefix sh: <http:\/\/www.w3.org\/ns\/shacl#> .\r\n@prefix ex: <http:\/\/shacl-practice.helio\/resource\/>.\r\n@prefix ec: <http:\/\/shacl-practice.helio\/ontology#>\r\n\r\n<#-- DONE: define the new sh:NodeShape with restriction sh:targetSubjectsOf for property schema:postalCode  -->\r\nex:SubjectPostalCodeShape \r\n  a sh:NodeShape ; \r\n  sh:targetSubjectsOf schema:postalCode ; \r\n  sh:property ex:LocalityShape . <#-- DONE: relate the sh:NodeShape with the sh:PropertyShape -->\r\n\r\n<#-- DONE: define the new sh:PropertyShape for property schema:addressLocality and with restriction sh:minCount 1 -->\r\nex:LocalityShape \r\n  a sh:PropertyShape ;\r\n  sh:path schema:addressLocality ;\r\n  sh:minCount 1 .\r\n\r\nex:AddressPlusPostalShape \r\n  a sh:PropertyShape ;\r\n  sh:path ( schema:address schema:postalCode ) ;\r\n  sh:minCount 1 . \r\n\r\nex:UPRNShape a sh:PropertyShape ;\r\n  sh:path ec:uprn ;\r\n  sh:minCount 1 .\r\n\r\nex:CivicStructureShape \r\n  a sh:NodeShape ; \r\n  sh:targetClass schema:CivicStructure ;\r\n  sh:property ex:UPRNShape, ex:AddressPlusPostalShape  .\r\n\r\nex:MuseumShape \r\n  a sh:NodeShape ; \r\n  sh:targetClass schema:Museum ;\r\n  sh:property ex:UPRNShape .\r\n\r\nex:UniversityShape \r\n  a sh:NodeShape ; \r\n  sh:targetClass schema:CollegeOrUniversity ;\r\n  sh:property ex:UPRNShape .\r\n<\/#assign>\r\n\r\n<#--  Fetch and cast the RDF into NT serialization -->\r\n<#assign rdf = providers(\"HttpProvider\", {\"method\" : \"GET\", \"url\" : \"https:\/\/raw.githubusercontent.com\/helio-ecosystem\/helio-ecosystem\/main\/resources\/siotrx\/actions\/shacl\/lcc-dataset.ttl\"})>\r\n<#assign config = {\"data-format\" : \"turtle\", \"output-format\" : \"nt\"}>\r\n<@action type=\"RdfCast\" data=rdf conf=config; result>\r\n<#assign rdf = result>\r\n<\/@action>\r\n\r\n\r\n<#-- Running the validation -->\r\n<#-- configure the action to output report in NT serialization -->\r\n<#assign config=\"{\\\"shape\\\" : \\\"\"+shape+\"\\\", \\\"output-format\\\" : \\\"nt\\\"  }\">\r\n<@action type=\"ShaclValidator\" data=rdf conf=config; report>\r\n<#--  aggregate the RDF and the report into a variable-->\r\n<#assign rdf = rdf+\"\\n\"+report>\r\n<\/@action>\r\n\r\n<#--  DONE: change the query to return the number of instances in the dataset that are not conforming, i.e., not passing the validation, due to the new restrictions defined in the shape -->\r\n<#assign query> \r\nSELECT (count(distinct ?instance) as ?notConformingInstances) WHERE { \r\n    ?subject <http:\/\/www.w3.org\/ns\/shacl#focusNode> ?instance . \r\n    ?subject <http:\/\/www.w3.org\/ns\/shacl#sourceShape> <http:\/\/shacl-practice.helio\/resource\/LocalityShape> . \r\n} \r\n<\/#assign>\r\n<#assign config = '{\"query\" : \"'+query+'\" }'>\r\n<@action type=\"SparqlEngine\" data=rdf conf=config; result>\r\n[=result]\r\n<\/@action>\r\n",
    "user_template": "<#-- Shape --> \r\n<#assign shape>\r\n@prefix schema: <http:\/\/schema.org\/> .\r\n@prefix sh: <http:\/\/www.w3.org\/ns\/shacl#> .\r\n@prefix ex: <http:\/\/shacl-practice.helio\/resource\/>.\r\n@prefix ssn: <http:\/\/purl.oclc.org\/NET\/ssnx\/ssn#> .\r\n@prefix lcc: <http:\/\/smartcity.linkeddata.es\/lcc\/ontology\/EnergyConsumption#> .\r\n@prefix xsd: <http:\/\/www.w3.org\/2001\/XMLSchema#> .\r\n\r\n<#-- TODO: define the new sh:NodeShape associated to ssn:ObservationValue class -->\r\n<#-- TODO: define the new sh:PropertyShape for property lcc:hasQuantityValue with the restriction sh:minInclusive \"0\"^^xsd:decimal -->\r\n<#-- TODO: relate the sh:NodeShape with the sh:PropertyShape -->\r\n\r\n<\/#assign>\r\n\r\n<#--  Fetch and cast the RDF into NT serialization -->\r\n<#assign rdf = providers(\"HttpProvider\", {\"method\" : \"GET\", \"url\" : \"https:\/\/raw.githubusercontent.com\/helio-ecosystem\/helio-ecosystem\/main\/resources\/siotrx\/actions\/shacl\/lcc-dataset.ttl\"})>\r\n<#assign config = {\"data-format\" : \"turtle\", \"output-format\" : \"nt\"}>\r\n<@action type=\"RdfCast\" data=rdf conf=config; result>\r\n<#assign rdf = result>\r\n<\/@action>\r\n\r\n\r\n<#-- Running the validation -->\r\n<#-- configure the action to output report in NT serialization -->\r\n<#assign config='{\"shape\" : \"'+shape?js_string+'\", \"output-format\" : \"nt\"  }'>\r\n<@action type=\"ShaclValidator\" data=rdf conf=config; report>\r\n<#--  aggregate the RDF and the report into a variable-->\r\n<#assign rdf = rdf+\"\\n\"+report>\r\n<\/@action>\r\n\r\n<#--  TODO: change the query to return all those data instances that do not pass the validation, the value of their lcc:hasQuantityValue, and the sh:resultMessage obtained in the report -->\r\n<#assign query>\r\nPREFIX lcc: <http:\/\/smartcity.linkeddata.es\/lcc\/ontology\/EnergyConsumption#> \r\nPREFIX sh: <http:\/\/www.w3.org\/ns\/shacl#> \r\n\r\n\r\n<\/#assign>\r\n<#assign config = '{\"query\" : \"'+query+'\" }'>\r\n<@action type=\"SparqlEngine\" data=rdf conf=config; result>\r\n[=result]\r\n<\/@action>\r\n",
    "expected_result": "{ \"head\": {\r\n    \"vars\": [ \"instance\" , \"quantityValue\" , \"message\" ]\r\n  } ,\r\n  \"results\": {\r\n    \"bindings\": [\r\n      { \r\n        \"instance\": { \"type\": \"uri\" , \"value\": \"http:\/\/smartcity.linkeddata.es\/lcc\/resource\/ObservationValue\/GasParksandCountrysideTheWhitehouseCafe-2012-2013\" } ,\r\n        \"quantityValue\": { \"type\": \"literal\" , \"datatype\": \"http:\/\/www.w3.org\/2001\/XMLSchema#decimal\" , \"value\": \"-22274.23\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Data value -22274.23 is not greater than or equal to 0\" }\r\n      } ,\r\n      { \r\n        \"instance\": { \"type\": \"uri\" , \"value\": \"http:\/\/smartcity.linkeddata.es\/lcc\/resource\/ObservationValue\/GasChangingPavilionShawLaneSportsPavilion-2012-2013\" } ,\r\n        \"quantityValue\": { \"type\": \"literal\" , \"datatype\": \"http:\/\/www.w3.org\/2001\/XMLSchema#decimal\" , \"value\": \"-12503.53\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Data value -12503.53 is not greater than or equal to 0\" }\r\n      } ,\r\n      { \r\n        \"instance\": { \"type\": \"uri\" , \"value\": \"http:\/\/smartcity.linkeddata.es\/lcc\/resource\/ObservationValue\/OilShelteredHousing13WinroseDrive-2012-2013\" } ,\r\n        \"quantityValue\": { \"type\": \"literal\" , \"datatype\": \"http:\/\/www.w3.org\/2001\/XMLSchema#decimal\" , \"value\": \"-24056\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Data value \\\"-24056\\\"^^xsd:decimal is not greater than or equal to 0\" }\r\n      } ,\r\n      { \r\n        \"instance\": { \"type\": \"uri\" , \"value\": \"http:\/\/smartcity.linkeddata.es\/lcc\/resource\/ObservationValue\/GasCouncilOfficesBelleIsleFoundation-2012-2013\" } ,\r\n        \"quantityValue\": { \"type\": \"literal\" , \"datatype\": \"http:\/\/www.w3.org\/2001\/XMLSchema#decimal\" , \"value\": \"-52857.84\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Data value -52857.84 is not greater than or equal to 0\" }\r\n      } ,\r\n      { \r\n        \"instance\": { \"type\": \"uri\" , \"value\": \"http:\/\/smartcity.linkeddata.es\/lcc\/resource\/ObservationValue\/GasDepotLeedsGrandTheatre&OperaHouseStore-2012-2013\" } ,\r\n        \"quantityValue\": { \"type\": \"literal\" , \"datatype\": \"http:\/\/www.w3.org\/2001\/XMLSchema#decimal\" , \"value\": \"-10479.15\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Data value -10479.15 is not greater than or equal to 0\" }\r\n      } ,\r\n      { \r\n        \"instance\": { \"type\": \"uri\" , \"value\": \"http:\/\/smartcity.linkeddata.es\/lcc\/resource\/ObservationValue\/GasChildrensHomeLanshawCrescent-2012-2013\" } ,\r\n        \"quantityValue\": { \"type\": \"literal\" , \"datatype\": \"http:\/\/www.w3.org\/2001\/XMLSchema#decimal\" , \"value\": \"-46207.64\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Data value -46207.64 is not greater than or equal to 0\" }\r\n      } ,\r\n      { \r\n        \"instance\": { \"type\": \"uri\" , \"value\": \"http:\/\/smartcity.linkeddata.es\/lcc\/resource\/ObservationValue\/GasParksandCountrysideAbbeyHouseLodgeStaffFacilities&KirkstallValleyRangersOffice-2012-2013\" } ,\r\n        \"quantityValue\": { \"type\": \"literal\" , \"datatype\": \"http:\/\/www.w3.org\/2001\/XMLSchema#decimal\" , \"value\": \"-2282.21\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Data value -2282.21 is not greater than or equal to 0\" }\r\n      } ,\r\n      { \r\n        \"instance\": { \"type\": \"uri\" , \"value\": \"http:\/\/smartcity.linkeddata.es\/lcc\/resource\/ObservationValue\/GasCommunityCentreNowellMount-2012-2013\" } ,\r\n        \"quantityValue\": { \"type\": \"literal\" , \"datatype\": \"http:\/\/www.w3.org\/2001\/XMLSchema#decimal\" , \"value\": \"-123.29\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Data value -123.29 is not greater than or equal to 0\" }\r\n      } ,\r\n      { \r\n        \"instance\": { \"type\": \"uri\" , \"value\": \"http:\/\/smartcity.linkeddata.es\/lcc\/resource\/ObservationValue\/GasChangingPavilionShawLaneSportsPavilion-2010-2011\" } ,\r\n        \"quantityValue\": { \"type\": \"literal\" , \"datatype\": \"http:\/\/www.w3.org\/2001\/XMLSchema#decimal\" , \"value\": \"-10631\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Data value \\\"-10631\\\"^^xsd:decimal is not greater than or equal to 0\" }\r\n      } ,\r\n      { \r\n        \"instance\": { \"type\": \"uri\" , \"value\": \"http:\/\/smartcity.linkeddata.es\/lcc\/resource\/ObservationValue\/GasChangingPavilionGroveRoadBowlingPavilion-2011-2012\" } ,\r\n        \"quantityValue\": { \"type\": \"literal\" , \"datatype\": \"http:\/\/www.w3.org\/2001\/XMLSchema#decimal\" , \"value\": \"-2\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Data value \\\"-2\\\"^^xsd:decimal is not greater than or equal to 0\" }\r\n      } ,\r\n      { \r\n        \"instance\": { \"type\": \"uri\" , \"value\": \"http:\/\/smartcity.linkeddata.es\/lcc\/resource\/ObservationValue\/GasParksandCountrysideRoundhayParkSpecialistGardens-2011-2012\" } ,\r\n        \"quantityValue\": { \"type\": \"literal\" , \"datatype\": \"http:\/\/www.w3.org\/2001\/XMLSchema#decimal\" , \"value\": \"-6384.06\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Data value -6384.06 is not greater than or equal to 0\" }\r\n      } ,\r\n      { \r\n        \"instance\": { \"type\": \"uri\" , \"value\": \"http:\/\/smartcity.linkeddata.es\/lcc\/resource\/ObservationValue\/GasOtherInnerEastClusterLincolnFields-2012-2013\" } ,\r\n        \"quantityValue\": { \"type\": \"literal\" , \"datatype\": \"http:\/\/www.w3.org\/2001\/XMLSchema#decimal\" , \"value\": \"-7582.79\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Data value -7582.79 is not greater than or equal to 0\" }\r\n      } ,\r\n      { \r\n        \"instance\": { \"type\": \"uri\" , \"value\": \"http:\/\/smartcity.linkeddata.es\/lcc\/resource\/ObservationValue\/GasEarlyYearsCentreNorthGiptonChildrensCentre-2010-2011\" } ,\r\n        \"quantityValue\": { \"type\": \"literal\" , \"datatype\": \"http:\/\/www.w3.org\/2001\/XMLSchema#decimal\" , \"value\": \"-56136\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Data value \\\"-56136\\\"^^xsd:decimal is not greater than or equal to 0\" }\r\n      } ,\r\n      { \r\n        \"instance\": { \"type\": \"uri\" , \"value\": \"http:\/\/smartcity.linkeddata.es\/lcc\/resource\/ObservationValue\/GasDayCentreCliffordBrooke&KelletDayCentre79RoundhayRoad-2012-2013\" } ,\r\n        \"quantityValue\": { \"type\": \"literal\" , \"datatype\": \"http:\/\/www.w3.org\/2001\/XMLSchema#decimal\" , \"value\": \"-2468.53\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Data value -2468.53 is not greater than or equal to 0\" }\r\n      } ,\r\n      { \r\n        \"instance\": { \"type\": \"uri\" , \"value\": \"http:\/\/smartcity.linkeddata.es\/lcc\/resource\/ObservationValue\/OilLandlordsSupplyHousing15HamiltonAvenueFlats-2012-2013\" } ,\r\n        \"quantityValue\": { \"type\": \"literal\" , \"datatype\": \"http:\/\/www.w3.org\/2001\/XMLSchema#decimal\" , \"value\": \"-1085.478854\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Data value -1085.478854 is not greater than or equal to 0\" }\r\n      } ,\r\n      { \r\n        \"instance\": { \"type\": \"uri\" , \"value\": \"http:\/\/smartcity.linkeddata.es\/lcc\/resource\/ObservationValue\/GasShelteredHousingBurleyGreenhows-2010-2011\" } ,\r\n        \"quantityValue\": { \"type\": \"literal\" , \"datatype\": \"http:\/\/www.w3.org\/2001\/XMLSchema#decimal\" , \"value\": \"-14\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Data value \\\"-14\\\"^^xsd:decimal is not greater than or equal to 0\" }\r\n      } ,\r\n      { \r\n        \"instance\": { \"type\": \"uri\" , \"value\": \"http:\/\/smartcity.linkeddata.es\/lcc\/resource\/ObservationValue\/OilLandlordsSupplyHousing212TownStreet-2012-2013\" } ,\r\n        \"quantityValue\": { \"type\": \"literal\" , \"datatype\": \"http:\/\/www.w3.org\/2001\/XMLSchema#decimal\" , \"value\": \"-7453.537308\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Data value -7453.537308 is not greater than or equal to 0\" }\r\n      } ,\r\n      { \r\n        \"instance\": { \"type\": \"uri\" , \"value\": \"http:\/\/smartcity.linkeddata.es\/lcc\/resource\/ObservationValue\/GasCemeteryHunslet-2010-2011\" } ,\r\n        \"quantityValue\": { \"type\": \"literal\" , \"datatype\": \"http:\/\/www.w3.org\/2001\/XMLSchema#decimal\" , \"value\": \"-952\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Data value \\\"-952\\\"^^xsd:decimal is not greater than or equal to 0\" }\r\n      } ,\r\n      { \r\n        \"instance\": { \"type\": \"uri\" , \"value\": \"http:\/\/smartcity.linkeddata.es\/lcc\/resource\/ObservationValue\/GasDayCentreGroveVilla-2012-2013\" } ,\r\n        \"quantityValue\": { \"type\": \"literal\" , \"datatype\": \"http:\/\/www.w3.org\/2001\/XMLSchema#decimal\" , \"value\": \"-39811.32\" } ,\r\n        \"message\": { \"type\": \"literal\" , \"value\": \"Data value -39811.32 is not greater than or equal to 0\" }\r\n      }\r\n    ]\r\n  }\r\n}"
}
